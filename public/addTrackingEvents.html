<!DOCTYPE html>
<html>
<head>
    <title>Add Tracking Events</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Adding Sample Tracking Events</h1>
    <div id="status"></div>
    <script>
        const supabaseUrl = 'https://pdnqzpzqzomzqkqlkcyj.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBkbnF6cHpxem9tenFrcWxrY3lqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzI1MDQzNDgsImV4cCI6MjA0ODA4MDM0OH0.r0iTLjZJvvPJDj94NDz6P0Gqii5Ru8suSU7-YzUUSaw';
        const { createClient } = supabase;
        const supabaseClient = createClient(supabaseUrl, supabaseKey);

        const statusDiv = document.getElementById('status');

        async function addTrackingEvents() {
            const shipmentId = 'FS-00013';

            const events = [
                {
                    id: `TE-${Date.now()}-1`,
                    shipment_id: shipmentId,
                    date: '2025-09-18T09:00:00Z',
                    status: 'Awaiting Pickup',
                    location: 'Shenzhen Warehouse',
                    description: 'Shipment created and awaiting pickup',
                    type: 'tracking'
                },
                {
                    id: `TE-${Date.now()}-2`,
                    shipment_id: shipmentId,
                    date: '2025-09-19T14:30:00Z',
                    status: 'In Progress',
                    location: 'Shenzhen Warehouse',
                    description: 'Shipment picked up by carrier',
                    type: 'tracking'
                },
                {
                    id: `TE-${Date.now()}-3`,
                    shipment_id: shipmentId,
                    date: '2025-09-20T08:15:00Z',
                    status: 'In Transit',
                    location: 'Hong Kong International Airport',
                    description: 'Shipment departed origin facility',
                    type: 'tracking'
                },
                {
                    id: `TE-${Date.now()}-4`,
                    shipment_id: shipmentId,
                    date: '2025-09-21T16:45:00Z',
                    status: 'In Transit',
                    location: 'Los Angeles International Airport',
                    description: 'Shipment arrived at destination country',
                    type: 'tracking'
                },
                {
                    id: `TE-${Date.now()}-5`,
                    shipment_id: shipmentId,
                    date: '2025-09-22T10:00:00Z',
                    status: 'Customs',
                    location: 'LAX Customs',
                    description: 'Shipment undergoing customs clearance',
                    type: 'tracking'
                },
                {
                    id: `TE-${Date.now()}-6`,
                    shipment_id: shipmentId,
                    date: '2025-09-22T15:30:00Z',
                    status: 'In Transit',
                    location: 'Local Distribution Center',
                    description: 'Shipment cleared customs and en route to final destination',
                    type: 'tracking'
                },
                {
                    id: `TE-${Date.now()}-7`,
                    shipment_id: shipmentId,
                    date: '2025-09-22T21:00:00Z',
                    status: 'Delivered',
                    location: 'Amazon FBA ONT8',
                    description: 'Shipment delivered successfully',
                    type: 'tracking'
                }
            ];

            statusDiv.innerHTML = `<p>Adding ${events.length} tracking events for shipment ${shipmentId}...</p>`;

            for (let i = 0; i < events.length; i++) {
                const event = events[i];
                // Add small delay to ensure unique IDs
                await new Promise(resolve => setTimeout(resolve, 100));
                event.id = `TE-${Date.now()}-${i}`;

                const { data, error } = await supabaseClient
                    .from('tracking_events')
                    .insert(event)
                    .select()
                    .single();

                if (error) {
                    statusDiv.innerHTML += `<p style="color: red;">Error adding event ${i + 1}: ${error.message}</p>`;
                    console.error('Error:', error);
                } else {
                    statusDiv.innerHTML += `<p style="color: green;">âœ“ Added: ${event.description}</p>`;
                    console.log('Added:', data);
                }
            }

            // Verify by fetching
            const { data: fetchedEvents, error: fetchError } = await supabaseClient
                .from('tracking_events')
                .select('*')
                .eq('shipment_id', shipmentId)
                .order('date', { ascending: true });

            if (fetchError) {
                statusDiv.innerHTML += `<p style="color: red;">Error fetching events: ${fetchError.message}</p>`;
            } else {
                statusDiv.innerHTML += `<hr><p style="color: blue;">Successfully retrieved ${fetchedEvents.length} tracking events!</p>`;
                statusDiv.innerHTML += '<p>You can now refresh the shipment tracking page to see the timeline.</p>';
            }
        }

        // Run the function
        addTrackingEvents();
    </script>
</body>
</html>