<!DOCTYPE html>
<html>
<head>
    <title>Fix Supplier RLS for Mock Auth</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .info {
            background-color: #e7f3ff;
            border: 2px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .sql-box {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>üîß Fix Supplier RLS for Mock Authentication</h1>

    <div class="info">
        <h2>‚ÑπÔ∏è Issue Explanation</h2>
        <p>The app uses a mock authentication system (not Supabase Auth), so <code>auth.uid()</code> in RLS policies returns NULL.</p>
        <p>This causes the "row violates row-level security policy" error when creating suppliers.</p>
    </div>

    <h2>Option 1: Temporarily Disable RLS (Quick Fix for Development)</h2>
    <div class="sql-box">-- Temporarily disable RLS for suppliers table
-- WARNING: This removes user isolation - use only for development/testing
ALTER TABLE suppliers DISABLE ROW LEVEL SECURITY;</div>

    <h2>Option 2: Modify RLS Policies to Allow Based on user_id Match</h2>
    <div class="sql-box">-- Drop existing policies
DROP POLICY IF EXISTS "Users can view own suppliers" ON suppliers;
DROP POLICY IF EXISTS "Users can create own suppliers" ON suppliers;
DROP POLICY IF EXISTS "Users can update own suppliers" ON suppliers;
DROP POLICY IF EXISTS "Users can delete own suppliers" ON suppliers;

-- Create more permissive policies that check user_id column
-- These policies allow operations when user_id matches
CREATE POLICY "Users can view suppliers by user_id" ON suppliers
    FOR SELECT USING (true); -- Temporarily allow all reads

CREATE POLICY "Users can create suppliers with user_id" ON suppliers
    FOR INSERT WITH CHECK (user_id IS NOT NULL); -- Just ensure user_id is provided

CREATE POLICY "Users can update own suppliers" ON suppliers
    FOR UPDATE USING (true); -- Temporarily allow updates

CREATE POLICY "Users can delete own suppliers" ON suppliers
    FOR DELETE USING (true); -- Temporarily allow deletes</div>

    <h2>Option 3: Keep Privacy with Application-Level Filtering (Recommended)</h2>
    <p>Since we're already filtering by user_id in the application code, we can rely on that for privacy:</p>
    <div class="sql-box">-- Keep RLS enabled but make policies more permissive
-- The application code handles the actual filtering by user_id

-- Drop existing strict policies
DROP POLICY IF EXISTS "Users can view own suppliers" ON suppliers;
DROP POLICY IF EXISTS "Users can create own suppliers" ON suppliers;
DROP POLICY IF EXISTS "Users can update own suppliers" ON suppliers;
DROP POLICY IF EXISTS "Users can delete own suppliers" ON suppliers;

-- Create policies that ensure user_id is present but don't check auth
CREATE POLICY "Allow read suppliers with user_id" ON suppliers
    FOR SELECT USING (user_id IS NOT NULL);

CREATE POLICY "Allow create suppliers with user_id" ON suppliers
    FOR INSERT WITH CHECK (user_id IS NOT NULL);

CREATE POLICY "Allow update suppliers with user_id" ON suppliers
    FOR UPDATE USING (user_id IS NOT NULL);

CREATE POLICY "Allow delete suppliers with user_id" ON suppliers
    FOR DELETE USING (user_id IS NOT NULL);</div>

    <h2>Instructions:</h2>
    <ol>
        <li>Choose one of the options above based on your needs</li>
        <li>Copy the SQL for your chosen option</li>
        <li>Go to your <a href="https://app.supabase.com" target="_blank">Supabase Dashboard</a></li>
        <li>Navigate to SQL Editor</li>
        <li>Paste and run the SQL</li>
    </ol>

    <h3>‚ö†Ô∏è Important Notes:</h3>
    <ul>
        <li><strong>Option 1</strong> completely disables security - use only for development</li>
        <li><strong>Option 2</strong> provides basic validation but no real user isolation</li>
        <li><strong>Option 3</strong> (Recommended) keeps RLS enabled but relies on application-level filtering for privacy</li>
        <li>For production, you should implement proper Supabase Authentication</li>
    </ul>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</body>
</html>