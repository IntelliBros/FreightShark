<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Check Email Configuration</title>
    <style>
        body {
            font-family: system-ui;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
            background: #f9fafb;
        }
        h1 { color: #111827; }
        .config-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #e5e7eb;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .configured {
            background: #ecfdf5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        .not-configured {
            background: #fef2f2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 6px;
            border: none;
            background: #3b82f6;
            color: white;
            margin: 10px 10px 10px 0;
        }
        button:hover {
            background: #2563eb;
        }
        .warning {
            background: #fef3c7;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            border: 1px solid #f59e0b;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>Email Configuration Status</h1>

    <div id="status"></div>

    <div class="config-box">
        <h2>Quick SMTP Setup</h2>
        <div class="form-group">
            <label>Email Provider:</label>
            <select id="provider" onchange="updateProviderSettings()">
                <option value="">Select a provider...</option>
                <option value="gmail">Gmail</option>
                <option value="sendgrid">SendGrid</option>
                <option value="mailgun">Mailgun</option>
                <option value="custom">Custom SMTP</option>
            </select>
        </div>

        <div id="config-form" style="display: none;">
            <div class="form-group">
                <label>SMTP Host:</label>
                <input type="text" id="host" placeholder="smtp.gmail.com">
            </div>
            <div class="form-group">
                <label>Port:</label>
                <input type="number" id="port" placeholder="587">
            </div>
            <div class="form-group">
                <label>Secure (SSL/TLS):</label>
                <select id="secure">
                    <option value="false">No (Use STARTTLS)</option>
                    <option value="true">Yes (Direct SSL)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Username/Email:</label>
                <input type="text" id="username" placeholder="your-email@gmail.com">
            </div>
            <div class="form-group">
                <label>Password/App Password:</label>
                <input type="password" id="password" placeholder="Your app password">
                <small style="color: #6b7280;">For Gmail, use an App Password, not your regular password</small>
            </div>
            <div class="form-group">
                <label>From Name:</label>
                <input type="text" id="fromName" placeholder="FreightShark" value="FreightShark">
            </div>
            <div class="form-group">
                <label>From Email:</label>
                <input type="email" id="fromEmail" placeholder="noreply@freightshark.com">
            </div>

            <button onclick="saveConfig()">Save Configuration</button>
            <button onclick="testEmail()" style="background: #10b981;">Test Email</button>
        </div>
    </div>

    <div class="warning">
        <strong>Note:</strong> For Gmail, you need to:
        <ol>
            <li>Enable 2-factor authentication</li>
            <li>Generate an App Password (not your regular password)</li>
            <li>Use the App Password in the password field</li>
        </ol>
        <a href="https://support.google.com/accounts/answer/185833" target="_blank">Learn how to create an App Password →</a>
    </div>

    <script>
        function checkConfig() {
            const config = localStorage.getItem('freight_shark_smtp_config');
            const statusDiv = document.getElementById('status');

            if (config) {
                const smtpConfig = JSON.parse(config);
                statusDiv.innerHTML = `
                    <div class="status configured">
                        ✅ SMTP is configured
                    </div>
                    <div class="config-box">
                        <h3>Current Configuration:</h3>
                        <pre>${JSON.stringify(smtpConfig, null, 2)}</pre>
                    </div>
                `;

                // Populate form with existing config
                document.getElementById('host').value = smtpConfig.host || '';
                document.getElementById('port').value = smtpConfig.port || '';
                document.getElementById('secure').value = smtpConfig.secure ? 'true' : 'false';
                document.getElementById('username').value = smtpConfig.auth?.user || '';
                document.getElementById('fromName').value = smtpConfig.from?.name || 'FreightShark';
                document.getElementById('fromEmail').value = smtpConfig.from?.email || '';
            } else {
                statusDiv.innerHTML = `
                    <div class="status not-configured">
                        ❌ SMTP is NOT configured - Emails will be simulated only
                    </div>
                `;
            }
        }

        function updateProviderSettings() {
            const provider = document.getElementById('provider').value;
            const form = document.getElementById('config-form');

            if (!provider) {
                form.style.display = 'none';
                return;
            }

            form.style.display = 'block';

            switch(provider) {
                case 'gmail':
                    document.getElementById('host').value = 'smtp.gmail.com';
                    document.getElementById('port').value = '587';
                    document.getElementById('secure').value = 'false';
                    break;
                case 'sendgrid':
                    document.getElementById('host').value = 'smtp.sendgrid.net';
                    document.getElementById('port').value = '587';
                    document.getElementById('secure').value = 'false';
                    document.getElementById('username').value = 'apikey';
                    break;
                case 'mailgun':
                    document.getElementById('host').value = 'smtp.mailgun.org';
                    document.getElementById('port').value = '587';
                    document.getElementById('secure').value = 'false';
                    break;
            }
        }

        function saveConfig() {
            const config = {
                host: document.getElementById('host').value,
                port: parseInt(document.getElementById('port').value),
                secure: document.getElementById('secure').value === 'true',
                auth: {
                    user: document.getElementById('username').value,
                    pass: document.getElementById('password').value
                },
                from: {
                    name: document.getElementById('fromName').value,
                    email: document.getElementById('fromEmail').value
                }
            };

            localStorage.setItem('freight_shark_smtp_config', JSON.stringify(config));
            alert('Configuration saved! Emails will now be sent via SMTP.');
            checkConfig();
        }

        async function testEmail() {
            const testEmail = prompt('Enter email address to send test to:');
            if (!testEmail) return;

            // Import and use the EmailService
            const module = await import('../src/services/EmailService.ts');
            const result = await module.emailService.sendTestEmail(testEmail);

            if (result.success) {
                alert('Test email sent successfully! Check your inbox.');
            } else {
                alert('Failed to send test email: ' + result.message);
            }
        }

        // Check config on load
        checkConfig();
    </script>
</body>
</html>